<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Monorepo 初探 | Buu的网络日志</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="一个热爱生活的年轻人">
    
    <link rel="preload" href="/assets/css/0.styles.6b35793f.css" as="style"><link rel="preload" href="/assets/js/app.183b9101.js" as="script"><link rel="preload" href="/assets/js/2.a278bba6.js" as="script"><link rel="preload" href="/assets/js/3.1cfdd510.js" as="script"><link rel="prefetch" href="/assets/js/10.86371d32.js"><link rel="prefetch" href="/assets/js/11.f8eb6462.js"><link rel="prefetch" href="/assets/js/12.4e3944eb.js"><link rel="prefetch" href="/assets/js/13.2c4529c3.js"><link rel="prefetch" href="/assets/js/14.8f80a8a9.js"><link rel="prefetch" href="/assets/js/15.ca6fe91f.js"><link rel="prefetch" href="/assets/js/16.6496a2ce.js"><link rel="prefetch" href="/assets/js/17.1b615c33.js"><link rel="prefetch" href="/assets/js/18.9235f940.js"><link rel="prefetch" href="/assets/js/19.203604ce.js"><link rel="prefetch" href="/assets/js/20.8ce0edca.js"><link rel="prefetch" href="/assets/js/21.b906f0e9.js"><link rel="prefetch" href="/assets/js/22.650bf22f.js"><link rel="prefetch" href="/assets/js/23.b09355f0.js"><link rel="prefetch" href="/assets/js/4.1db79d83.js"><link rel="prefetch" href="/assets/js/5.71a03ea2.js"><link rel="prefetch" href="/assets/js/6.9a8c202a.js"><link rel="prefetch" href="/assets/js/7.e64861c6.js"><link rel="prefetch" href="/assets/js/8.fa7aecd9.js"><link rel="prefetch" href="/assets/js/9.bb6fa868.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6b35793f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Buu的网络日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/fe/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/docs/pm/" class="nav-link">
  产品
</a></div><div class="nav-item"><a href="/docs/others/" class="nav-link">
  杂七杂八
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/fe/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/docs/pm/" class="nav-link">
  产品
</a></div><div class="nav-item"><a href="/docs/others/" class="nav-link">
  杂七杂八
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术实践</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>业务沉淀</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>专项知识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/fe/knowledge-project/link-tag-use/" class="sidebar-link">&lt;link&gt; 使用场景</a></li><li><a href="/docs/fe/knowledge-project/what-is-monorepo/" aria-current="page" class="active sidebar-link">Monorepo 初探</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="monorepo-初探"><a href="#monorepo-初探" class="header-anchor">#</a> Monorepo 初探</h1> <p></p><div class="table-of-contents"><ul><li><a href="#什么是-monorepo">什么是 monorepo?</a><ul><li><a href="#优缺点">优缺点</a></li><li><a href="#与-monorepo-对应的是-multirepo">与 monorepo 对应的是 multirepo</a></li></ul></li><li><a href="#创建一个-monorepo-项目">创建一个 monorepo 项目</a><ul><li><a href="#众说纷纭">众说纷纭</a></li><li><a href="#一、yarn-workspaces">一、yarn workspaces</a></li><li><a href="#二、lerna-5-1">二、lerna 5.1+</a></li></ul></li></ul></div><p></p> <blockquote><p>monorepo 本身并不是一个新的概念，只是旧事重提</p></blockquote> <h2 id="什么是-monorepo"><a href="#什么是-monorepo" class="header-anchor">#</a> 什么是 monorepo?</h2> <p>单个代码库里包含了许多项目的代码，这些项目虽然有可能是相关，但通常在逻辑上是独立的，并由不同的“团队[每个人都可以是一个团队]”维护 的 一种代码管理策略。</p> <h3 id="优缺点"><a href="#优缺点" class="header-anchor">#</a> 优缺点</h3> <p>优点：</p> <ul><li>易于代码重用</li> <li>简化依赖管理，</li> <li>大规模代码重构</li> <li>跨团队协作</li></ul> <p>缺点：</p> <ul><li>新人学习成本比较高</li> <li>缺乏每个项目的访问控制</li> <li>默认情况下需要更多的存储空间</li></ul> <h3 id="与-monorepo-对应的是-multirepo"><a href="#与-monorepo-对应的是-multirepo" class="header-anchor">#</a> 与 monorepo 对应的是 multirepo</h3> <p>multirepo 则是通过多个仓库的方式来管理每一个模块、功能或者应用。无论是 monorepo 或者 multirepo，都只是一种软件开发中代码的管理策略，本身并无孰优孰劣的区别，也不是非 mono 即 multi 的问题。</p> <p>如图：</p> <p><img src="/assets/img/apps-monorepo_1.be622989.png" alt=""></p> <h2 id="创建一个-monorepo-项目"><a href="#创建一个-monorepo-项目" class="header-anchor">#</a> 创建一个 monorepo 项目</h2> <h3 id="众说纷纭"><a href="#众说纷纭" class="header-anchor">#</a> 众说纷纭</h3> <p>脉脉某个程序抛出了个问题“现在前端搞 monorepo 比较好的方案有没有”</p> <ul><li>yarn+workspaces</li> <li>lerna</li> <li>rush + pnpm</li> <li>pnpm workspace</li> <li>pnpm + @abmao/pkgs</li> <li>pnpm +turborepo+changesets（pnpm workspace 做拆分，changeset 做版本控制，turborepo 做多线程打包） , 水平够上 rush。
<ul><li>这三套加起来就是 rush。</li></ul></li> <li>rush or pnpm + workspace</li> <li>lerna + (yarn + workspace)</li></ul> <h3 id="一、yarn-workspaces"><a href="#一、yarn-workspaces" class="header-anchor">#</a> 一、yarn workspaces</h3> <h4 id="hoist-nohoist"><a href="#hoist-nohoist" class="header-anchor">#</a> hoist &amp; nohoist</h4> <p>hoist /hɔɪst/</p> <p>hoist： 将公共的依赖包提取出来，集中到同一层目录下。如下图：</p> <p><img src="/assets/img/what-is-monorepo_1.f3da7cb8.png" alt=""></p> <p>事实上，在有些时候，在打包子项目的时候，会出现模块找不到的情况，例如 package-1 打包的时候，依赖的 A（1.0）可以在 node_module,找到 B(1.0)，但是 C(1.0)并不一定是支持 monorepo 模式的第三方库。如下图：</p> <p><img src="/assets/img/what-is-monorepo_2.d01fcc5d.png" alt=""></p> <p>nohoist
是一种处理对 monorepo 不兼容的第三方库的一个方案，可以通过配置 nohoist 指定 yarn 不对该模板进行提示。如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//根目录package.json</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;workspance&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;packages&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span>
    <span class="token string-property property">&quot;nohoist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/react-native&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;**/react-native/**&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//子项目，不使用nohoist</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//子项目，使用nohoist</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;nohoist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react-native&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-native/**&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><img src="/assets/img/what-is-monorepo_3.d0b31353.png" alt=""></p> <h4 id="什么是-workspace"><a href="#什么是-workspace" class="header-anchor">#</a> 什么是 workspace</h4> <ol><li>当项目中的 package 有依赖关系时，workspace 会自动对 package 的引用设置软链接（symlink）,且链接仅限于当前的 workspace。</li> <li>所有的 package 的依赖都会安装在根目录的 node_modules，节省一定的空间。</li> <li>依赖同一份 yarn.lock。</li></ol> <h4 id="使用-workspace"><a href="#使用-workspace" class="header-anchor">#</a> 使用 workspace</h4> <p>配置 package.json</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//package.json</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;monorepo-demo&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;workspaces&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token string">&quot;packages/*&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span><span class="token boolean">true</span>
设置根目录的内容不发布。
workspaces
声明workspace中<span class="token keyword">package</span>的路径。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="项目运行"><a href="#项目运行" class="header-anchor">#</a> 项目运行</h5> <p><code>yarn workspace [package-name] commond</code></p> <h5 id="例如"><a href="#例如" class="header-anchor">#</a> 例如</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>-monorepo
  -packages
    -hy-gift-display
    -pw-coolect
-package.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>mult: <code>npm run start</code></p> <p>mono: <code>yarn workspace hy-gift-display run start</code></p> <h5 id="查看-workspace-依赖树"><a href="#查看-workspace-依赖树" class="header-anchor">#</a> 查看 workspace 依赖树</h5> <p><code>yarn workspaces info --json</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm包整合demo
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;app1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;location&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packages/app1&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;workspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;mismatchedWorkspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;jsfunc&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;app2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;location&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packages/app2&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;workspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;jsfunc&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;mismatchedWorkspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;app3&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;location&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packages/app3&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;workspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;mismatchedWorkspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;app4&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;location&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packages/app4&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;workspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;mismatchedWorkspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;jsfunc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;location&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packages/jsfunc&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;workspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;mismatchedWorkspaceDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>workspaceDependencies: 工作区内依赖的 package</p> <p>mismatchedWorkspaceDependencies：工作区内依赖的 package，但版本不匹配。</p> <h5 id="问题"><a href="#问题" class="header-anchor">#</a> 问题：</h5> <ul><li>当一个子项目更新后，只能手动追踪依赖更新版本。</li></ul> <h3 id="二、lerna-5-1"><a href="#二、lerna-5-1" class="header-anchor">#</a> 二、lerna 5.1+</h3> <p>什么是 lerna？在 yarn 1.x workspace 官方的文档里面有这样一段描述。</p> <p>Yarn’s workspaces are the low-level primitives that tools like Lerna can (and do!) use.</p> <p>yarn 对于 lerna 的描述是一个更好的一个解决方案/用法，也明确表示不会去支持类似 lerna 中的功能。那在 lerna 的官网的描述是这样的，“是一个管理工具，用于管理包含多个软件包（package）的 JavaScript 项目。”</p> <h4 id="开始一个-lerna-项目"><a href="#开始一个-lerna-项目" class="header-anchor">#</a> 开始一个 lerna 项目</h4> <p><a href="https://github.com/lerna/getting-started-example" target="_blank" rel="noopener noreferrer">https://github.com/lerna/getting-started-example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以直接拉取这个案例在本地尝试。</p> <p><code>$ npx lerna init</code></p> <p>多了一个 lerna.json</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;packages/*&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;useNx&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>packages: 指定 workspace 的目录</p> <p>useNx: 是否使用 Nx。</p> <p><strong>packages 很好理解，那什么是 Nx？</strong></p> <p>Smart,Fast and Extendsible Build System. Next generation build sysem with first class monorepo support and powerful integrations.</p> <p>这是一个可以独立使用的 monorepo 的构建系统，具体可以看官网，在 learn 中，nx 扮演的角色是“缓存已构建内容”， 默认情况下，本地缓存有效期为一周，一周后将自动清除。</p> <p>nx 除了扮演缓存的角色之后，还有一个我们可以用到的功能，就是可视化 monorepo 项目之间的依赖管理，如：</p> <p><code>$ npx nx grap</code></p> <p>某仓库内 pacekge 的关系如下：</p> <p><img src="/assets/img/what-is-monorepo_4.0ab6b4f1.png" alt=""></p> <h4 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h4> <p><code>$ lerna boostrap</code></p> <p>当在一个 lerna-monorepo 项目运行 boostrap，会进行以下行为：</p> <ol><li>在各个 packages 内执行 npm install</li> <li>将 packages 相互引用的子应用引用关联，让子应用之间可以像 npm 包那样调用，类似 npm link</li></ol> <p>注意：项目初始化需要执行。</p> <p><code>$ lerna run scriptName</code></p> <p>运行 script，例如</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//demo1
$lerna run build
*等同于在所有子应用都运行 npm run build;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><details class="custom-block details"><summary>配置项</summary> <p><code>--scope</code></p> <p>指定某个自引用运行 script。</p> <p><code>--stream</code></p> <p>leran 输出子应用打包子进程相关日志。</p> <p><code>--concurrency</code></p> <p>指定数量并发执行 script。</p></details> <p><code>$ lerna clean</code></p> <p>清除子应用 node_module、monorepo 根目录 node_module</p> <p><code>$ lerna add &lt;package&gt;[@version] [--dev] [--exact] [--peer]</code></p> <details class="custom-block details"><summary>配置项</summary> <p><code>--dev</code></p> <p>packages 添加到 devDependencies</p> <p><code>--exact</code></p> <p>需要精确版本，例如 1.1.0 而不是^1.1.0</p> <p><code>--peer</code>
packages 添加到 peerDependencies</p></details> <p><code>$ lerna import</code></p> <p>用于旧项目迁移，迁移 mulit 应用到 monorepo 项目底下，迁移的同时，会同时同步 master 的所有 commit，例如</p> <div class="custom-block tip"><p class="custom-block-title">参考</p> <ol><li><a href="https://fed.taobao.org/blog/taofed/do71ct/uihagy/" target="_blank" rel="noopener noreferrer">All in one：项目级 monorepo 策略最佳实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.robinwieruch.de/javascript-monorepos/" target="_blank" rel="noopener noreferrer">Monorepos in JavaScript &amp; TypeScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.yuque.com/docs/share/69ee97ff-42cc-46cf-a409-31967339a9cf" target="_blank" rel="noopener noreferrer">monorepo 设计思路<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s/X6eehnbs055Gmiw56Zs_DA" target="_blank" rel="noopener noreferrer">深入浅出 npm &amp; yarn &amp; pnpm 包管理机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://classic.yarnpkg.com/blog/2018/02/15/nohoist/" target="_blank" rel="noopener noreferrer">nohoist in Workspaces<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/fe/knowledge-project/link-tag-use/" class="prev">
        &lt;link&gt; 使用场景
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.183b9101.js" defer></script><script src="/assets/js/2.a278bba6.js" defer></script><script src="/assets/js/3.1cfdd510.js" defer></script>
  </body>
</html>
